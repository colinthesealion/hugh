{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/js/arduino.ts","webpack:///./src/js/color-picker.ts","webpack:///./src/js/color.ts","webpack:///./src/js/controller.ts","webpack:///./src/js/index.ts"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;;AClFa;AACb,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;;;;;;;;;;;;;ACrCa;AACb;AACA;AACA,mCAAmC,MAAM,6BAA6B,EAAE,YAAY,WAAW,EAAE;AACjG,kCAAkC,MAAM,iCAAiC,EAAE,YAAY,WAAW,EAAE;AACpG,+BAA+B,iEAAiE,uBAAuB,EAAE,4BAA4B;AACrJ;AACA,KAAK;AACL;AACA;AACA,aAAa,6BAA6B,0BAA0B,aAAa,EAAE,qBAAqB;AACxG,gBAAgB,qDAAqD,oEAAoE,aAAa,EAAE;AACxJ,sBAAsB,sBAAsB,qBAAqB,GAAG;AACpE;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC;AACvC,kCAAkC,SAAS;AAC3C,kCAAkC,WAAW,UAAU;AACvD,yCAAyC,cAAc;AACvD;AACA,6GAA6G,OAAO,UAAU;AAC9H,gFAAgF,iBAAiB,OAAO;AACxG,wDAAwD,gBAAgB,QAAQ,OAAO;AACvF,8CAA8C,gBAAgB,gBAAgB,OAAO;AACrF;AACA,iCAAiC;AACjC;AACA;AACA,SAAS,YAAY,aAAa,OAAO,EAAE,UAAU,WAAW;AAChE,mCAAmC,SAAS;AAC5C;AACA;AACA,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD,2BAA2B,EAAE;AACpF;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;;;;;;;;;;;;;ACrKa;AACb;AACA;AACA,gDAAgD,OAAO;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,cAAc;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,uBAAuB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK,aAAa,qBAAqB;AACvC;AACA;AACA;AACA;AACA;AACA,mBAAmB,YAAY;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5Fa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,cAAc;AAC5D,8BAA8B,mBAAO,CAAC,kCAAS;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,2CAA2C;AAC5C;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;;;;;;;;;;;;;AC7Ka;AACb;AACA,4CAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,cAAc;AAC5D,gCAAgC,mBAAO,CAAC,sCAAW;AACnD,qCAAqC,mBAAO,CAAC,gDAAgB;AAC7D,gCAAgC,mBAAO,CAAC,4CAAc;AACtD,8BAA8B,mBAAO,CAAC,kCAAS;AAC/C;AACA;AACA;AACA;AACA,SAAS,8BAA8B;AACvC,SAAS,gCAAgC;AACzC,SAAS,gCAAgC;AACzC,SAAS,8BAA8B;AACvC,SAAS,8BAA8B;AACvC,SAAS,gCAAgC;AACzC,SAAS,iCAAiC;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC","file":"light-controller.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/js/index.ts\");\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Arduino = /** @class */ (function () {\n    function Arduino(_a) {\n        var _this = this;\n        var server = _a.server, port = _a.port, endpoint = _a.endpoint, debug = _a.debug;\n        this.isConnected = false;\n        if (!('WebSocket' in window)) {\n            throw new Error('WebSockets not supported by this browser');\n        }\n        var address = \"ws://\" + server + \":\" + port + \"/\" + endpoint;\n        this.arduino = new WebSocket(address);\n        this.arduino.onopen = function () {\n            console.log(\"Connected to \" + address);\n            _this.isConnected = true;\n        };\n        this.arduino.onerror = function (error) {\n            console.error('Arduino connection error', error);\n            _this.isConnected = false;\n        };\n        if (debug) {\n            this.arduino.onmessage = function (event) {\n                console.log('Server: ' + event.data);\n            };\n        }\n    }\n    Arduino.prototype.isAvailable = function () {\n        return this.isConnected;\n    };\n    Arduino.prototype.sendData = function (data) {\n        if (this.isConnected) {\n            this.arduino.send(JSON.stringify(data));\n        }\n        return this.isConnected;\n    };\n    return Arduino;\n}());\nexports.default = Arduino;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction getCoordinatesFromMouseEvent(event) {\n    return {\n        x: event.offsetX,\n        y: event.offsetY,\n    };\n}\nfunction getCoordinatesFromTouchEvent(event) {\n    var target = event.target;\n    var _a = target.getBoundingClientRect(), left = _a.left, top = _a.top;\n    var _b = event.targetTouches[0], pageX = _b.pageX, pageY = _b.pageY;\n    return {\n        x: pageX - left,\n        y: pageY - top,\n    };\n}\nvar ColorPicker = /** @class */ (function () {\n    function ColorPicker(_a) {\n        var canvas = _a.canvas, imageSrc = _a.imageSrc, onColorChange = _a.onColorChange, changeOnRelease = _a.changeOnRelease;\n        this.context = null;\n        this.dragging = false;\n        this.changeOnRelease = false;\n        this.canvas = canvas;\n        this.promiseForImage = new Promise(function (resolve, reject) {\n            var image = new Image();\n            image.onload = function () {\n                resolve(image);\n            };\n            image.onerror = function () {\n                reject(\"Could not load \" + imageSrc);\n            };\n            image.src = imageSrc;\n        });\n        this.onColorChange = onColorChange;\n        this.changeOnRelease = !!changeOnRelease;\n        this.drawCanvas();\n        this.addEventListeners();\n    }\n    ColorPicker.prototype.addEventListeners = function () {\n        var _this = this;\n        // Window events\n        window.addEventListener('resize', function () { return _this.drawCanvas(); });\n        // Mouse events\n        this.canvas.addEventListener('mousedown', function (event) {\n            _this.dragging = true;\n            if (!_this.changeOnRelease) {\n                _this.changeColor(getCoordinatesFromMouseEvent(event));\n            }\n        });\n        this.canvas.addEventListener('mousemove', function (event) {\n            if (_this.dragging && !_this.changeOnRelease) {\n                _this.changeColor(getCoordinatesFromMouseEvent(event));\n            }\n        });\n        this.canvas.addEventListener('mouseup', function (event) {\n            if (_this.changeOnRelease) {\n                _this.changeColor(getCoordinatesFromMouseEvent(event));\n            }\n            _this.dragging = false;\n        });\n        // Touch events\n        this.canvas.addEventListener('touchstart', function (event) {\n            event.preventDefault();\n            event.stopPropagation();\n            _this.dragging = true;\n            if (!_this.changeOnRelease && event.targetTouches.length) {\n                _this.changeColor(getCoordinatesFromTouchEvent(event));\n            }\n        });\n        this.canvas.addEventListener('touchmove', function (event) {\n            event.stopPropagation();\n            if (_this.dragging && !_this.changeOnRelease && event.targetTouches.length) {\n                _this.changeColor(getCoordinatesFromTouchEvent(event));\n            }\n        });\n        this.canvas.addEventListener('touchcancel', function () {\n            _this.dragging = false;\n        });\n        this.canvas.addEventListener('touchend', function (event) {\n            event.preventDefault();\n            event.stopPropagation();\n            if (_this.changeOnRelease && event.targetTouches.length) {\n                _this.changeColor(getCoordinatesFromTouchEvent(event));\n            }\n            _this.dragging = false;\n        });\n    };\n    ColorPicker.prototype.drawCanvas = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var parent, size, image;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        parent = this.canvas.parentElement;\n                        if (!parent) {\n                            throw new Error('Could not find parent element');\n                        }\n                        size = Math.min(parent.offsetHeight, parent.offsetWidth);\n                        this.canvas.width = size - 30;\n                        this.canvas.height = size - 30;\n                        this.context = this.canvas.getContext('2d');\n                        if (!this.context) return [3 /*break*/, 2];\n                        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n                        return [4 /*yield*/, this.promiseForImage];\n                    case 1:\n                        image = _a.sent();\n                        this.context.drawImage(image, 0, 0, this.canvas.width, this.canvas.height);\n                        _a.label = 2;\n                    case 2: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ColorPicker.prototype.changeColor = function (_a) {\n        var x = _a.x, y = _a.y;\n        if (this.context) {\n            var colorData = this.context.getImageData(x, y, 1, 1).data;\n            this.onColorChange({\n                red: colorData[0],\n                green: colorData[1],\n                blue: colorData[2],\n            });\n        }\n    };\n    ColorPicker.prototype.setChangeOnRelease = function (changeOnRelease) {\n        this.changeOnRelease = changeOnRelease;\n    };\n    return ColorPicker;\n}());\nexports.default = ColorPicker;\n","\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction toString(color) {\n    if (Object.prototype.hasOwnProperty.call(color, 'alpha')\n        && color.alpha !== undefined) {\n        return \"rgba(\" + color.red + \", \" + color.green + \", \" + color.blue + \", \" + color.alpha + \")\";\n    }\n    else {\n        return \"rgb(\" + color.red + \", \" + color.green + \", \" + color.blue + \")\";\n    }\n}\nexports.toString = toString;\nfunction reduce(reducer, initialColor) {\n    var colors = [];\n    for (var _i = 2; _i < arguments.length; _i++) {\n        colors[_i - 2] = arguments[_i];\n    }\n    var color = colors.reduce(function (reduction, color) {\n        reduction.red = reducer(reduction.red, color.red);\n        reduction.green = reducer(reduction.green, color.green);\n        reduction.blue = reducer(reduction.blue, color.blue);\n        if (reduction.hasOwnProperty('alpha')\n            || color.hasOwnProperty('alpha')) {\n            reduction.alpha = reducer(reduction.alpha || 0, color.alpha || 0);\n        }\n        return reduction;\n    }, initialColor);\n    return color;\n}\nexports.reduce = reduce;\nfunction interpolateColor(start, end, factor) {\n    return reduce(function (reduction, channel) {\n        return Math.round(reduction + factor * (channel - reduction));\n    }, __assign({}, start), __assign({}, end));\n}\nexports.interpolateColor = interpolateColor;\nfunction interpolateColors(start, end, nSteps) {\n    var stepFactor = 1 / (nSteps - 1);\n    var colors = [];\n    for (var i = 0; i < nSteps; i++) {\n        colors.push(interpolateColor(start, end, stepFactor * i));\n    }\n    return colors;\n}\nexports.interpolateColors = interpolateColors;\nfunction toLinearGradient(direction, colors) {\n    var colorStrings = colors.map(toString);\n    if (direction !== 'down') {\n        colorStrings.unshift(\"to  \" + direction);\n    }\n    return \"linear-gradient(\" + colorStrings.join(',') + \")\";\n}\nexports.toLinearGradient = toLinearGradient;\nfunction equals(color1, color2) {\n    if (!color1 && !color2) {\n        return true;\n    }\n    else if (!color1) {\n        return false;\n    }\n    else if (!color2) {\n        return false;\n    }\n    else if (color1.red !== color2.red) {\n        return false;\n    }\n    else if (color1.green !== color2.green) {\n        return false;\n    }\n    else if (color1.blue !== color2.blue) {\n        return false;\n    }\n    else if (Object.prototype.hasOwnProperty.call(color1, 'alpha')\n        && Object.prototype.hasOwnProperty.call(color2, 'alpha')\n        && color1.alpha !== color2.alpha) {\n        return false;\n    }\n    else {\n        return true;\n    }\n}\nexports.equals = equals;\n","\"use strict\";\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ColorUtils = __importStar(require(\"./color\"));\nvar MODE;\n(function (MODE) {\n    MODE[MODE[\"CHOOSE\"] = 0] = \"CHOOSE\";\n    MODE[MODE[\"CASCADE\"] = 1] = \"CASCADE\";\n    MODE[MODE[\"PALETTE\"] = 2] = \"PALETTE\";\n    MODE[MODE[\"CASCADE_PALLETTE\"] = 3] = \"CASCADE_PALLETTE\";\n    MODE[MODE[\"RAINBOW\"] = 4] = \"RAINBOW\";\n})(MODE = exports.MODE || (exports.MODE = {}));\nexports.MODE_OPTIONS = [\n    {\n        name: 'Rainbow',\n        value: MODE.RAINBOW,\n    },\n    {\n        name: 'Choose a Color',\n        value: MODE.CHOOSE,\n    },\n    {\n        name: 'Cascade a Color',\n        value: MODE.CASCADE,\n    },\n    {\n        name: 'Choose a Palette',\n        value: MODE.PALETTE,\n    },\n    {\n        name: 'Cascade a Palette',\n        value: MODE.CASCADE_PALLETTE,\n    },\n];\nvar Controller = /** @class */ (function () {\n    function Controller(_a) {\n        var deltaMs = _a.deltaMs, nSteps = _a.nSteps;\n        this.palette = [];\n        this.mode = MODE.CHOOSE;\n        this.deltaMs = deltaMs;\n        this.nSteps = nSteps;\n        this.mode = MODE.RAINBOW;\n        this.currentColor = {\n            red: 0,\n            green: 0,\n            blue: 0,\n        };\n    }\n    Controller.prototype.startPaletteShift = function () {\n        var _this = this;\n        if (this.intervalId) {\n            return;\n        }\n        if (this.palette.length < 1) {\n            this.currentColor = {\n                red: 0,\n                green: 0,\n                blue: 0,\n            };\n        }\n        else if (this.palette.length === 1) {\n            this.currentColor = this.palette[0];\n        }\n        else {\n            var startIndex_1 = 0;\n            var nextIndex_1 = 1;\n            var increment_1 = 1;\n            var colors_1 = ColorUtils.interpolateColors(this.palette[startIndex_1], this.palette[nextIndex_1], this.nSteps);\n            var stepIndex_1 = 0;\n            this.currentColor = colors_1[stepIndex_1++];\n            this.intervalId = window.setInterval(function () {\n                if (stepIndex_1 >= _this.nSteps) {\n                    startIndex_1 += increment_1;\n                    nextIndex_1 += increment_1;\n                    if (nextIndex_1 >= _this.palette.length) {\n                        nextIndex_1 = startIndex_1 - 1;\n                        increment_1 = -1;\n                    }\n                    else if (nextIndex_1 < 0) {\n                        nextIndex_1 = startIndex_1 + 1;\n                        increment_1 = 1;\n                    }\n                    colors_1 = ColorUtils.interpolateColors(_this.palette[startIndex_1], _this.palette[nextIndex_1], _this.nSteps);\n                    stepIndex_1 = 0;\n                }\n                _this.currentColor = colors_1[stepIndex_1++];\n            }, this.deltaMs);\n        }\n    };\n    Controller.prototype.handleColorChange = function (color) {\n        switch (this.mode) {\n            case MODE.CHOOSE:\n            case MODE.CASCADE: {\n                this.currentColor = color;\n                break;\n            }\n            case MODE.PALETTE:\n            case MODE.CASCADE_PALLETTE: {\n                if (!ColorUtils.equals(color, this.palette.slice(-1)[0])) {\n                    this.palette.push(color);\n                    this.startPaletteShift();\n                }\n                break;\n            }\n            case MODE.RAINBOW: {\n                break;\n            }\n            default: {\n                throw new Error(\"Unknown mode: \" + this.mode);\n            }\n        }\n    };\n    Controller.prototype.setMode = function (mode) {\n        if (this.mode !== mode) {\n            if (mode === MODE.PALETTE\n                || mode === MODE.CASCADE_PALLETTE) {\n                this.clearPalette();\n            }\n            window.clearInterval(this.intervalId);\n            this.intervalId = undefined;\n            this.mode = mode;\n        }\n    };\n    Controller.prototype.getMode = function () {\n        return this.mode;\n    };\n    Controller.prototype.clearPalette = function () {\n        if (this.intervalId) {\n            window.clearInterval(this.intervalId);\n        }\n        this.palette = [];\n    };\n    Controller.prototype.getPayload = function () {\n        var payload;\n        switch (this.mode) {\n            case MODE.RAINBOW:\n                payload = {\n                    command: 'rainbow',\n                };\n                break;\n            case MODE.CHOOSE:\n            case MODE.CASCADE:\n                payload = {\n                    command: (this.mode === MODE.CHOOSE) ? 'all' : 'cascade',\n                    color: this.currentColor,\n                };\n                break;\n            case MODE.PALETTE:\n            case MODE.CASCADE_PALLETTE:\n                payload = {\n                    command: (this.mode === MODE.PALETTE) ? 'all' : 'cascade',\n                    color: this.currentColor,\n                };\n                break;\n            default:\n            // no-op\n        }\n        if (this.previousPayload && payload\n            && this.previousPayload.command === payload.command\n            && ColorUtils.equals(this.previousPayload.color, payload.color)) {\n            return undefined;\n        }\n        this.previousPayload = payload;\n        return payload;\n    };\n    return Controller;\n}());\nexports.default = Controller;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar arduino_1 = __importDefault(require(\"./arduino\"));\nvar color_picker_1 = __importDefault(require(\"./color-picker\"));\nvar controller_1 = __importStar(require(\"./controller\"));\nvar ColorUtils = __importStar(require(\"./color\"));\nvar arduino;\nfunction paintRainbow() {\n    delete document.body.style.background;\n    document.body.style.backgroundImage = ColorUtils.toLinearGradient('down', [\n        { red: 255, green: 0, blue: 0 },\n        { red: 255, green: 165, blue: 0 },\n        { red: 255, green: 255, blue: 0 },\n        { red: 0, green: 255, blue: 0 },\n        { red: 0, green: 0, blue: 255 },\n        { red: 128, green: 0, blue: 128 },\n        { red: 199, green: 21, blue: 133 },\n    ]);\n}\npaintRainbow();\ntry {\n    arduino = new arduino_1.default({\n        server: 'hugh.local',\n        port: 9998,\n        endpoint: 'console',\n    });\n}\ncatch (e) {\n    console.error('Could not connect to arduino');\n}\nvar deltaMs = 200;\nvar controller = new controller_1.default({\n    deltaMs: deltaMs,\n    nSteps: 20,\n});\nvar canvasBlock = document.querySelector('#color-block');\nvar canvasStrip = document.querySelector('#color-strip');\nif (!canvasBlock || !canvasStrip) {\n    throw new Error('Cannot find canvas in the document');\n}\nvar colorPicker = new color_picker_1.default({\n    canvasBlock: canvasBlock,\n    canvasStrip: canvasStrip,\n    imageSrc: 'images/colorwheel3.png',\n    onColorChange: function (color) {\n        controller.handleColorChange(color);\n        if ((controller.getMode() === controller_1.MODE.PALETTE\n            || controller.getMode() === controller_1.MODE.CASCADE_PALLETTE)\n            && controller.palette.length > 1) {\n            delete document.body.style.background;\n            document.body.style.backgroundImage = ColorUtils.toLinearGradient('down', controller.palette);\n        }\n        else if (controller.getMode() !== controller_1.MODE.RAINBOW) {\n            delete document.body.style.backgroundImage;\n            document.body.style.background = ColorUtils.toString(color);\n        }\n    },\n});\nvar clearPalette = document.querySelector('#clear-palette');\nif (clearPalette) {\n    clearPalette.addEventListener('click', function () {\n        controller.clearPalette();\n        delete document.body.style.backgroundImage;\n        document.body.style.background = 'black';\n    });\n}\nvar dropdownMenu = document.querySelector('.dropdown-menu');\nif (dropdownMenu) {\n    controller_1.MODE_OPTIONS.forEach(function (option) {\n        var menuItem = document.createElement('a');\n        menuItem.className = 'dropdown-item';\n        menuItem.href = '#';\n        menuItem.innerText = option.name;\n        menuItem.addEventListener('click', function () {\n            controller.setMode(option.value);\n            if (option.value === controller_1.MODE.RAINBOW) {\n                paintRainbow();\n            }\n            else {\n                document.body.style.background = 'black';\n            }\n            if (clearPalette) {\n                clearPalette.style.display = (option.value === controller_1.MODE.PALETTE || option.value === controller_1.MODE.CASCADE_PALLETTE)\n                    ? 'block'\n                    : 'none';\n            }\n            /*\n            colorPicker.setChangeOnRelease(\n              option.value === MODE.PALETTE\n              || option.value === MODE.CASCADE_PALLETTE\n            );\n            */\n            colorPicker.drawCanvas();\n        });\n        dropdownMenu.appendChild(menuItem);\n    });\n}\nsetInterval(function () {\n    colorPicker; // to keep it from getting garbage collected\n    var payload = controller.getPayload();\n    if (payload) {\n        if (arduino && arduino.isAvailable()) {\n            arduino.sendData(JSON.stringify(payload));\n        }\n        else {\n            console.log(payload);\n        }\n    }\n}, deltaMs);\n"],"sourceRoot":""}